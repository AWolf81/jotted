!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Jotted=b()}(this,function(){"use strict";function a(){return'\n    <ul class="jotted-nav">\n      <li class="jotted-nav-item jotted-nav-item-result">\n        <a href="#" data-jotted-type="result">\n          Result\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-html">\n        <a href="#" data-jotted-type="html">\n          HTML\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-css">\n        <a href="#" data-jotted-type="css">\n          CSS\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-js">\n        <a href="#" data-jotted-type="js">\n          JavaScript\n        </a>\n      </li>\n    </ul>\n    <div class="jotted-pane jotted-pane-result">\n      <iframe></iframe>\n    </div>\n    <div class="jotted-pane jotted-pane-html"></div>\n    <div class="jotted-pane jotted-pane-css"></div>\n    <div class="jotted-pane jotted-pane-js"></div>\n  '}function b(a){return"jotted-pane-active-"+a}function c(){return"jotted"}function d(){return"jotted-show-blank"}function e(a){return"jotted-has-"+a}function f(a){return"jotted-editor jotted-editor-"+a}function g(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return'\n    <textarea data-jotted-type="'+a+'" data-jotted-file="'+b+'"></textarea>\n    <div class="jotted-error"></div>\n  '}function h(a){return"\n    <p>"+a+"</p>\n  "}function i(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c={};return Object.keys(b).forEach(function(d){"undefined"!=typeof a[d]?c[d]=a[d]:c[d]=b[d]}),c}function j(a,b){var c=new window.XMLHttpRequest;c.open("GET",a),c.responseType="text",c.onload=function(){200===c.status?b(null,c.response):b(c)},c.onerror=function(a){b(a)},c.send()}function k(a,b,c,d,e){return function(b,f){b&&d.push(b),a++,a===c.length?e(d,f):l(a,f,c,d,e)}}function l(a,b,c,d,e){c[a](b,k.apply(this,arguments))}function m(a,b){var c=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],d=[];return a.length?void l(0,b,a,d,c):c(d,b)}function n(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function o(){console.log(arguments)}function p(a){var b=!0,c=!1,d=void 0;try{for(var e,f=u[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(g._id===a)return g}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}throw new Error("Plugin "+a+" is not registered.")}function q(a,b){b._id=a,u.push(b)}function r(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.options.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=void 0,h={};"string"==typeof f?g=p(f):"object"===("undefined"==typeof f?"undefined":t["typeof"](f))&&(g=p(f.name),h=f.options||{}),this.plugins[f]=new g(this,h)}}catch(i){b=!0,c=i}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}}function s(a){a.plugin("codemirror",C),a.plugin("ace",B),a.plugin("less",A),a.plugin("coffeescript",z),a.plugin("stylus",y),a.plugin("babel",x),a.plugin("markdown",w)}var t={};t["typeof"]=function(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},t.classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();var u=[],v=function(){function a(){t.classCallCheck(this,a),this.topics={},this.callbacks={}}return t.createClass(a,[{key:"find",value:function(a){return this.topics[a]=this.topics[a]||[],this.topics[a]}},{key:"subscribe",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?90:arguments[2],d=this.find(a);b._priority=c,d.push(b),d.sort(function(a,b){return a._priority>b._priority?1:b._priority>a._priority?-1:0})}},{key:"unsubscribe",value:function(a,b){var c=this.find(a);c.forEach(function(a){if(!b)return void(a.length=0);var c=[].indexOf.call(a,b);return-1===c?o("Subscriber not found in topic"):void a.splice(c,1)})}},{key:"publish",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=this.find(a),d=[];c.forEach(function(a){d.push(a)}),m(d,b,this.runCallbacks(a))}},{key:"runCallbacks",value:function(a){var b=this;return function(){b.callbacks[a]=b.callbacks[a]||[];var c=!0,d=!1,e=void 0;try{for(var f,g=b.callbacks[a][Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.apply(this,arguments)}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}}}},{key:"done",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)}}]),a}(),w=function(){function a(b,c){t.classCallCheck(this,a);var d=20;this.options=i(c,{}),"undefined"!=typeof window.marked&&(window.marked.setOptions(c),b.$container.classList.add("jotted-plugin-markdown"),b.$container.querySelector('a[data-jotted-type="html"]').innerHTML="Markdown",b.on("change",this.change.bind(this),d))}return t.createClass(a,[{key:"change",value:function(a,b){if("html"===a.type){try{a.content=window.marked(a.content)}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),a}(),x=function(){function a(b,c){t.classCallCheck(this,a);var d=20;this.options=i(c,{presets:["es2015"]}),"undefined"!=typeof window.Babel&&(b.$container.classList.add("jotted-plugin-babel"),b.$container.querySelector('a[data-jotted-type="js"]').innerHTML="ES6",b.on("change",this.change.bind(this),d))}return t.createClass(a,[{key:"change",value:function(a,b){if("js"===a.type){try{a.content=window.Babel.transform(a.content,this.options).code}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),a}(),y=function(){function a(b,c){t.classCallCheck(this,a);var d=20;c=i(c,{}),"undefined"!=typeof window.stylus&&(b.$container.classList.add("jotted-plugin-stylus"),b.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Stylus",b.on("change",this.change.bind(this),d))}return t.createClass(a,[{key:"isStylus",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".styl")||""===a.file}},{key:"change",value:function(a,b){this.isStylus(a)?window.stylus(a.content,this.options).render(function(c,d){return c?b(c,a):(a.content=d,void b(null,a))}):b(null,a)}}]),a}(),z=function(){function a(b,c){t.classCallCheck(this,a);var d=20;c=i(c,{}),"undefined"!=typeof window.CoffeeScript&&(b.$container.classList.add("jotted-plugin-less"),b.$container.querySelector('a[data-jotted-type="js"]').innerHTML="CoffeeScript",b.on("change",this.change.bind(this),d))}return t.createClass(a,[{key:"isCoffee",value:function(a){return"js"!==a.type?!1:-1!==a.file.indexOf(".coffee")||""===a.file}},{key:"change",value:function(a,b){if(this.isCoffee(a))try{a.content=window.CoffeeScript.compile(a.content)}catch(c){return b(c,a)}b(null,a)}}]),a}(),A=function(){function a(b,c){t.classCallCheck(this,a);var d=20;c=i(c,{}),"undefined"!=typeof window.less&&(b.$container.classList.add("jotted-plugin-less"),b.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Less",b.on("change",this.change.bind(this),d))}return t.createClass(a,[{key:"isLess",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".less")||""===a.file}},{key:"change",value:function(a,b){this.isLess(a)?window.less.render(a.content,this.options,function(c,d){return c?b(c,a):(a.content=d.css,void b(null,a))}):b(null,a)}}]),a}(),B=function(){function a(b,c){var d=this;t.classCallCheck(this,a);var e,f=1;if(this.editor={},this.modemap={html:"html",css:"css",js:"javascript",less:"less",coffee:"coffeescript"},c=i(c,{}),"undefined"!=typeof window.ace){b.$container.classList.add("jotted-plugin-ace");var g=b.$container.querySelectorAll(".jotted-editor"),h=function(){var a=g[e].querySelector("textarea"),f=a.dataset.jottedType,h=a.dataset.jottedFile,j=document.createElement("div");g[e].appendChild(j),d.editor[f]=window.ace.edit(j);var k=d.editor[f],l=i(c);k.getSession().setMode(d.aceMode(f,h)),k.getSession().setOptions(l),k.$blockScrolling=1/0,k.on("change",function(){a.value=k.getValue(),b.trigger("change",{aceEditor:k,type:f,file:h,content:a.value})})};for(e=0;e<g.length;e++)h();b.on("change",this.change.bind(this),f)}}return t.createClass(a,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.aceEditor||c.getSession().setValue(a.content),a.content=c.getValue(),b(null,a)}},{key:"aceMode",value:function(a,b){var c="ace/mode/";for(var d in this.modemap)if(-1!==b.indexOf("."+d))return c+this.modemap[d];for(var d in this.modemap)if(a===d)return c+this.modemap[d];return c+a}}]),a}(),C=function(){function a(b,c){var d=this;t.classCallCheck(this,a);var e,f=1;if(this.editor={},c=i(c,{lineNumbers:!0}),"undefined"!=typeof window.CodeMirror){b.$container.classList.add("jotted-plugin-codemirror");var g=b.$container.querySelectorAll(".jotted-editor"),h=function(){var a=g[e].querySelector("textarea"),f=a.dataset.jottedType,h=a.dataset.jottedFile;d.editor[f]=window.CodeMirror.fromTextArea(a,c);var i=d.editor[f];i.on("change",function(){a.value=i.getValue(),b.trigger("change",{cmEditor:i,type:f,file:h,content:a.value})})};for(e=0;e<g.length;e++)h();b.on("change",this.change.bind(this),f)}}return t.createClass(a,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.cmEditor||c.setValue(a.content),a.content=c.getValue(),b(null,a)}}]),a}(),D=function(){function k(e,f){t.classCallCheck(this,k),this.options=i(f,{files:[],showBlank:!1,pane:"result",debounce:250,plugins:{}}),this.pubsoup=new v,this.trigger=n(this.pubsoup.publish.bind(this.pubsoup),this.options.debounce),this.plugins={},this.$container=e,this.$container.innerHTML=a(),this.$container.classList.add(c()),this.options.showEmpty&&this.$container.classList.add(d()),this.paneActive=this.options.pane,this.$container.classList.add(b(this.paneActive)),this.$result=e.querySelector(".jotted-pane-result"),this.$pane={},this.$error={};for(var g=["html","css","js"],h=0;h<g.length;h++){var j=g[h];this.$pane[j]=e.querySelector(".jotted-pane-"+j),this.markup(j,this.$pane[j]),this.$error[j]=this.$pane[j].querySelector(".jotted-error")}this.$resultFrame=this.$result.querySelector("iframe"),this.$styleInject=document.createElement("style"),this.$resultFrame.contentWindow.document.head.appendChild(this.$styleInject),this.$container.addEventListener("change",n(this.change.bind(this),this.options.debounce)),this.$container.addEventListener("keyup",n(this.change.bind(this),this.options.debounce)),this.$container.addEventListener("click",this.pane.bind(this)),r.call(this),this.done("change",this.changeCallback.bind(this)),this.options.showBlank&&this.$container.classList.add("jotted-nav-show-blank")}return t.createClass(k,[{key:"findFile",value:function(a){var b={},c=!0,d=!1,e=void 0;try{for(var f,g=this.options.files[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;if(h.type===a)return h}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b}},{key:"markup",value:function(a,b){var c=this,d=this.findFile(a),h=document.createElement("div");h.innerHTML=g(a,d.url),h.className=f(a);var i=h.querySelector("textarea");b.appendChild(h),("undefined"!=typeof d.url||"undefined"!=typeof d.content)&&(this.$container.classList.add(e(a)),"undefined"!=typeof d.content?this.setValue(i,d.content):"undefined"!=typeof d.url&&j(d.url,function(b,e){return b?void c.error([b.responseText],{type:a,file:d}):void c.setValue(i,e)}))}},{key:"setValue",value:function(a,b){a.value=b,this.change({target:a})}},{key:"change",value:function(a){a.target.dataset.jottedType&&this.trigger("change",{type:a.target.dataset.jottedType,file:a.target.dataset.jottedFile,content:a.target.value})}},{key:"changeCallback",value:function(a,b){if(this.error(a,b),"html"===b.type)return void(this.$resultFrame.contentWindow.document.body.innerHTML=b.content);if("css"===b.type)return void(this.$styleInject.textContent=b.content);if("js"!==b.type);else try{this.$resultFrame.contentWindow.eval(b.content)}catch(c){a.length||this.error([c.message],{type:"js"})}}},{key:"pane",value:function(a){a.target.dataset.jottedType&&(this.$container.classList.remove(b(this.paneActive)),this.paneActive=a.target.dataset.jottedType,this.$container.classList.add(b(this.paneActive)),a.preventDefault())}},{key:"on",value:function(){this.pubsoup.subscribe.apply(this.pubsoup,arguments)}},{key:"off",value:function(){this.pubsoup.unsubscribe.apply(this.pubsoup,arguments)}},{key:"done",value:function(){this.pubsoup.done.apply(this.pubsoup,arguments)}},{key:"error",value:function(a,b){if(!a.length)return this.clearError(b);this.$container.classList.add("jotted-error-active-"+b.type);var c="",d=!0,e=!1,f=void 0;try{for(var g,i=a[Symbol.iterator]();!(d=(g=i.next()).done);d=!0){var j=g.value;c+=h(j)}}catch(j){e=!0,f=j}finally{try{!d&&i["return"]&&i["return"]()}finally{if(e)throw f}}this.$error[b.type].innerHTML=c}},{key:"clearError",value:function(a){this.$container.classList.remove("jotted-error-active-"+a.type),this.$error[a.type].innerHTML=""}}]),k}();return D.plugin=function(){return q.apply(this,arguments)},s(D),D});