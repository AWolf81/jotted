!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Jotted=b()}(this,function(){"use strict";function a(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c={};return Object.keys(a).forEach(function(b){c[b]=a[b]}),Object.keys(b).forEach(function(d){"undefined"!=typeof c[d]?c[d]=a[d]:c[d]=b[d]}),c}function b(a,b){var c=new window.XMLHttpRequest;c.open("GET",a),c.responseType="text",c.onload=function(){200===c.status?b(null,c.responseText):b(a,c)},c.onerror=function(a){b(a)},c.send()}function c(a,b,c,e,f){return function(b,g){b&&e.push(b),a++,a===c.length?f(e,g):d(a,g,c,e,f)}}function d(a,b,d,e,f){d[a](b,c.apply(this,arguments))}function e(a,b){var c=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],e=[];return a.length?void d(0,b,a,e,c):c(e,b)}function f(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function g(){console.log(arguments)}function h(a,b){if(!a.className)return!1;var c=" "+a.className+" ";return b=" "+b+" ",-1!==c.indexOf(b)?!0:!1}function i(a,b){return h(a,b)?a.className:(a.className&&(b=" "+b),a.className+=b,a.className)}function j(a,b){var c=" "+b,d=b+" ";return-1!==a.className.indexOf(c)?a.className=a.className.replace(c,""):-1!==a.className.indexOf(d)?a.className=a.className.replace(d,""):a.className=a.className.replace(b,""),a.className}function k(a,b){return a.getAttribute("data-"+b)}function l(){return'\n    <ul class="jotted-nav">\n      <li class="jotted-nav-item jotted-nav-item-result">\n        <a href="#" data-jotted-type="result">\n          Result\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-html">\n        <a href="#" data-jotted-type="html">\n          HTML\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-css">\n        <a href="#" data-jotted-type="css">\n          CSS\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-js">\n        <a href="#" data-jotted-type="js">\n          JavaScript\n        </a>\n      </li>\n    </ul>\n    <div class="jotted-pane jotted-pane-result"><iframe></iframe></div>\n    <div class="jotted-pane jotted-pane-html"></div>\n    <div class="jotted-pane jotted-pane-css"></div>\n    <div class="jotted-pane jotted-pane-js"></div>\n  '}function m(a){return"jotted-pane-active-"+a}function n(){return"jotted"}function o(a){return"jotted-has-"+a}function p(a){return"jotted-editor jotted-editor-"+a}function q(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return'\n    <textarea data-jotted-type="'+a+'" data-jotted-file="'+b+'"></textarea>\n    <div class="jotted-status"></div>\n  '}function r(a){return"\n    <p>"+a+"</p>\n  "}function s(a){return"jotted-status-"+a}function t(a){return"jotted-status-active-"+a}function u(a){return"jotted-plugin-"+a}function v(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return"\n    <!doctype html>\n    <html>\n    <head>\n    </head>\n    <body>\n    "+a+"\n    </body>\n    </html>\n  "}function w(a){return"Loading <strong>"+a+"</strong>.."}function x(a){return"There was an error loading <strong>"+a+"</strong>."}function y(a){for(var b in G){var c=G[b];if(c._id===a)return c}throw new Error("Plugin "+a+" is not registered.")}function z(a,b){b._id=a,G.push(b)}function A(){var a=this;this._get("options").plugins.forEach(function(b){var c=void 0,d=void 0,e={};"string"==typeof b?d=b:"object"===("undefined"==typeof b?"undefined":F["typeof"](b))&&(d=b.name,e=b.options||{}),c=y(d),a._get("plugins")[b]=new c(a,e),i(a._get("$container"),u(d))})}function B(a,b){var c=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],d=document.createElement("script");d.type="text/javascript",b.src?(d.onload=function(){setTimeout(c)},d.onerror=c,d.src=b.src):d.textContent=b.textContent,a.document.body.appendChild(d),b.parentNode.removeChild(b),b.src||c()}function C(a){var b=document.createEvent("Event");b.initEvent("DOMContentLoaded",!0,!0),a.document.dispatchEvent(b)}function D(a){for(var b,c=this,d=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],f=a.contentWindow,g=f.document.body.querySelectorAll("script"),h=g.length,i=[],j=function(a){b=g[a].getAttribute("type"),b&&-1===H.indexOf(b)||i.push(function(b,d){B.call(c,f,g[a],d)})},k=0;h>k;k++)j(k);e(i,{},function(){C(f),d()})}function E(a){a.plugin("codemirror",K),a.plugin("ace",J),a.plugin("less",L),a.plugin("coffeescript",M),a.plugin("stylus",N),a.plugin("babel",O),a.plugin("markdown",P)}var F={};F["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},F.classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},F.createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();var G=[],H=["text/javascript","text/ecmascript","application/javascript","application/ecmascript"],I=function(){function a(){F.classCallCheck(this,a),this.topics={},this.callbacks={}}return F.createClass(a,[{key:"find",value:function(a){return this.topics[a]=this.topics[a]||[],this.topics[a]}},{key:"subscribe",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?90:arguments[2],d=this.find(a);b._priority=c,d.push(b),d.sort(function(a,b){return a._priority>b._priority?1:b._priority>a._priority?-1:0})}},{key:"unsubscribe",value:function(a,b){var c=this.find(a);c.forEach(function(a){if(!b)return void(a.length=0);var c=[].indexOf.call(a,b);return-1===c?g("Subscriber not found in topic"):void a.splice(c,1)})}},{key:"publish",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=this.find(a),d=[];c.forEach(function(a){d.push(a)}),e(d,b,this.runCallbacks(a))}},{key:"runCallbacks",value:function(a){var b=this;return function(){var c=this,d=arguments;b.callbacks[a]=b.callbacks[a]||[],b.callbacks[a].forEach(function(a){a.apply(c,d)})}}},{key:"done",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)}}]),a}(),J=function(){function b(c,d){var e=this;F.classCallCheck(this,b);var f,g=1;if(this.editor={},this.modemap={html:"html",css:"css",js:"javascript",less:"less",coffee:"coffeescript"},d=a(d,{}),"undefined"!=typeof window.ace){var h=c.$container.querySelectorAll(".jotted-editor"),i=function(){var b=h[f].querySelector("textarea"),g=k(b,"jotted-type"),i=k(b,"jotted-file"),j=document.createElement("div");h[f].appendChild(j),e.editor[g]=window.ace.edit(j);var l=e.editor[g],m=a(d);l.getSession().setMode(e.aceMode(g,i)),l.getSession().setOptions(m),l.$blockScrolling=1/0,l.on("change",function(){b.value=l.getValue(),c.trigger("change",{aceEditor:l,type:g,file:i,content:b.value})})};for(f=0;f<h.length;f++)i();c.on("change",this.change.bind(this),g)}}return F.createClass(b,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.aceEditor||c.getSession().setValue(a.content),a.content=c.getValue(),b(null,a)}},{key:"aceMode",value:function(a,b){var c="ace/mode/";for(var d in this.modemap)if(-1!==b.indexOf("."+d))return c+this.modemap[d];for(var d in this.modemap)if(a===d)return c+this.modemap[d];return c+a}}]),b}(),K=function(){function b(c,d){var e=this;F.classCallCheck(this,b);var f,g=1;if(this.editor={},d=a(d,{lineNumbers:!0}),"undefined"!=typeof window.CodeMirror){var h=c.$container.querySelectorAll(".jotted-editor"),i=function(){var a=h[f].querySelector("textarea"),b=k(a,"jotted-type"),g=k(a,"jotted-file");e.editor[b]=window.CodeMirror.fromTextArea(a,d);var i=e.editor[b];i.on("change",function(){a.value=i.getValue(),c.trigger("change",{cmEditor:i,type:b,file:g,content:a.value})})};for(f=0;f<h.length;f++)i();c.on("change",this.change.bind(this),g)}}return F.createClass(b,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.cmEditor||c.setValue(a.content),a.content=c.getValue(),b(null,a)}}]),b}(),L=function(){function b(c,d){F.classCallCheck(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.less&&(c.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Less",c.on("change",this.change.bind(this),e))}return F.createClass(b,[{key:"isLess",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".less")||""===a.file}},{key:"change",value:function(a,b){this.isLess(a)?window.less.render(a.content,this.options,function(c,d){return c?b(c,a):(a.content=d.css,void b(null,a))}):b(null,a)}}]),b}(),M=function(){function b(c,d){F.classCallCheck(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.CoffeeScript&&(c.$container.querySelector('a[data-jotted-type="js"]').innerHTML="CoffeeScript",c.on("change",this.change.bind(this),e))}return F.createClass(b,[{key:"isCoffee",value:function(a){return"js"!==a.type?!1:-1!==a.file.indexOf(".coffee")||""===a.file}},{key:"change",value:function(a,b){if(this.isCoffee(a))try{a.content=window.CoffeeScript.compile(a.content)}catch(c){return b(c,a)}b(null,a)}}]),b}(),N=function(){function b(c,d){F.classCallCheck(this,b);var e=20;d=a(d,{}),"undefined"!=typeof window.stylus&&(c.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Stylus",c.on("change",this.change.bind(this),e))}return F.createClass(b,[{key:"isStylus",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".styl")||""===a.file}},{key:"change",value:function(a,b){this.isStylus(a)?window.stylus(a.content,this.options).render(function(c,d){return c?b(c,a):(a.content=d,void b(null,a))}):b(null,a)}}]),b}(),O=function(){function b(c,d){F.classCallCheck(this,b);var e=20;if(this.options=a(d,{}),"undefined"!=typeof window.Babel)this.babel=window.Babel;else{if("undefined"==typeof window.babel)return;this.babel={transform:window.babel}}c.$container.querySelector('a[data-jotted-type="js"]').innerHTML="ES2015",c.on("change",this.change.bind(this),e)}return F.createClass(b,[{key:"change",value:function(a,b){if("js"===a.type){try{a.content=this.babel.transform(a.content,this.options).code}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),b}(),P=function(){function b(c,d){F.classCallCheck(this,b);var e=20;this.options=a(d,{}),"undefined"!=typeof window.marked&&(window.marked.setOptions(d),c.$container.querySelector('a[data-jotted-type="html"]').innerHTML="Markdown",c.on("change",this.change.bind(this),e))}return F.createClass(b,[{key:"change",value:function(a,b){if("html"===a.type){try{a.content=window.marked(a.content)}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),b}(),Q=function(){function c(b,d){if(F.classCallCheck(this,c),!b)throw new Error("Can't find Jotted container.");var e={};this._get=function(a){return e[a]},this._set=function(a,b){return e[a]=b,e[a]};var g=this._set("options",a(d,{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,plugins:[]})),h=this._set("pubsoup",new I);this._set("trigger",f(h.publish.bind(h),g.debounce)),this._set("on",function(){h.subscribe.apply(h,arguments)}),this._set("off",function(){h.unsubscribe.apply(h,arguments)});var j=this._set("done",function(){h.done.apply(h,arguments)});j("change",this.changeCallback.bind(this));var k=this._set("$container",b);k.innerHTML=l(),i(k,n());var p=this._set("paneActive",g.pane);i(k,m(p)),this._set("content",{html:"",css:"",js:""}),this._set("$status",{});for(var q=["html","css","js"],r=0;r<q.length;r++){var s=q[r];this.markup(s)}k.addEventListener("change",f(this.change.bind(this),g.debounce)),k.addEventListener("keyup",f(this.change.bind(this),g.debounce)),k.addEventListener("click",this.pane.bind(this)),this.$container=this._get("$container"),this.on=this._get("on"),this.off=this._get("off"),this.done=this._get("done"),this.trigger=this._get("trigger"),this.paneActive=this._get("paneActive"),this._set("plugins",{}),A.call(this);for(var t=["html","css","js"],u=0;u<t.length;u++){var s=t[u];this.load(s)}if(g.showBlank)for(var v=["html","css","js"],w=0;w<v.length;w++){var s=v[w];i(k,o(s))}}return F.createClass(c,[{key:"findFile",value:function(a){var b={},c=this._get("options");for(var d in c.files){var e=c.files[d];if(e.type===a)return e}return b}},{key:"markup",value:function(a){var b=this._get("$container"),c=b.querySelector(".jotted-pane-"+a),d=this.findFile(a),e=document.createElement("div");e.innerHTML=q(a,d.url),e.className=p(a),c.appendChild(e),this._get("$status")[a]=c.querySelector(".jotted-status"),("undefined"!=typeof d.url||"undefined"!=typeof d.content)&&i(b,o(a))}},{key:"load",value:function(a){var c=this,d=this.findFile(a),e=this._get("$container").querySelector(".jotted-pane-"+a+" textarea");"undefined"!=typeof d.content?this.setValue(e,d.content):"undefined"!=typeof d.url&&(this.status("loading",[w(d.url)],{type:a,file:d}),b(d.url,function(b,d){return b?void c.status("error",[x(b)],{type:a}):(c.clearStatus("loading",{type:a}),void c.setValue(e,d))}))}},{key:"setValue",value:function(a,b){a.value=b,this.change({target:a})}},{key:"change",value:function(a){k(a.target,"jotted-type")&&this._get("pubsoup").publish("change",{type:k(a.target,"jotted-type"),file:k(a.target,"jotted-file"),content:a.target.value})}},{key:"runJS",value:function(a,b){var c=this._get("$container"),d=c.querySelector(".jotted-pane-result iframe");try{d.contentWindow.eval(b)}catch(e){a.length||this.status("error",[e.message],{type:"js"})}}},{key:"changeCallback",value:function(a,b){var c=this;this.status("error",a,b);var d=this._get("options"),e=this._get("$container"),f=e.querySelector(".jotted-pane-result"),g=f.querySelector("iframe");d.runScripts&&(f.removeChild(g),g=document.createElement("iframe"),f.appendChild(g));var h=g.contentWindow.document;h.open(),h.write(v()),h.close();var i=this._get("content");i[b.type]=b.content,h.body.innerHTML=i.html;var j=document.createElement("style");j.textContent=i.css,h.head.appendChild(j),d.runScripts?D.call(this,g,function(){c.runJS(a,i.js)}):this.runJS(a,i.js)}},{key:"pane",value:function(a){if(k(a.target,"jotted-type")){var b=this._get("$container"),c=this._get("paneActive");j(b,m(c)),c=this._set("paneActive",k(a.target,"jotted-type")),i(b,m(c)),a.preventDefault()}}},{key:"status",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"error":arguments[0],b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!b.length)return this.clearStatus(a,c);var d=this._get("$status");i(d[c.type],s(a)),i(this._get("$container"),t(c.type));var e="";b.forEach(function(a){e+=r(a)}),d[c.type].innerHTML=e}},{key:"clearStatus",value:function(a,b){var c=this._get("$status");j(c[b.type],s(a)),j(this._get("$container"),t(b.type)),c[b.type].innerHTML=""}}]),c}();return Q.plugin=function(){return z.apply(this,arguments)},E(Q),Q});